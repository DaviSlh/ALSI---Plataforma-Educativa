<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ALSI - Plataforma Educativa</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    /* Tus estilos CSS existentes */
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      display: flex;
      height: 100vh;
      background-color: #f9f6fb;
      color: #4a3054;
      transition: background-color 0.3s ease, color 0.3s ease; /* Transici√≥n para el modo oscuro */
    }
    aside {
      width: 220px;
      background-color: #c39bd3;
      padding: 2rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      color: white;
      align-items: center;
      transition: background-color 0.3s ease, color 0.3s ease; /* Transici√≥n para el modo oscuro */
    }
    aside img {
      width: 130px;
      height: auto;
      margin-bottom: 1.5rem;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    aside h1 {
      font-size: 1.8rem;
      margin-bottom: 2rem;
      text-align: center;
    }
    aside button {
      background: none;
      border: none;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      padding: 0.5rem;
      text-align: left;
      width: 100%;
      transition: background 0.3s;
    }
    aside button:hover {
      background-color: #af7ac5;
      border-radius: 8px;
    }
    main {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
      position: relative;
      transition: background-color 0.3s ease, color 0.3s ease; /* Transici√≥n para el modo oscuro */
    }
    .progress-bar-container {
      background-color: #e8dff3;
      height: 6px;
      width: 100%;
      position: absolute;
      top: 0;
      left: 0;
      transition: background-color 0.3s ease; /* Transici√≥n para el modo oscuro */
    }
    .progress-bar-fill {
      background-color: #b27ac5;
      height: 100%;
      width: 0%;
      transition: width 0.6s ease, background-color 0.3s ease; /* Transici√≥n para el modo oscuro */
    }
    .search-container {
      margin: 1.5rem 0;
    }
    .search-container input {
      width: 100%;
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      background-color: #fff; /* Asegurar color de fondo en claro */
      color: #4a3054; /* Asegurar color de texto en claro */
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; /* Transici√≥n para el modo oscuro */
    }
    .lessons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }
    .lesson-card {
      background: #fff;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
      text-align: center;
      position: relative;
      cursor: pointer;
      transition: transform 0.2s ease, background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease; /* Transici√≥n para el modo oscuro */
    }
    .lesson-card:hover {
      transform: scale(1.02);
    }
    .lesson-card h3 { margin: 0 0 0.5rem; }
    .lesson-card p { font-size: 0.9rem; color: #555; margin-bottom: 1rem; transition: color 0.3s ease; /* Transici√≥n para el modo oscuro */ }
    .lesson-card button {
      background-color: #c39bd3;
      color: #fff;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 0.5rem;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s ease, color 0.3s ease; /* Transici√≥n para el modo oscuro */
    }
    .lesson-card.completed {
      border: 2px solid #af7ac5;
    }
    .lesson-card .check {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1.5rem;
      color: #28a745;
    }
    /* Estilos para lecciones bloqueadas */
    .lesson-card.locked {
        opacity: 0.6; /* Un poco m√°s de opacidad para indicar bloqueo */
        pointer-events: none; /* Desactiva clics */
        cursor: not-allowed;
        box-shadow: none; /* Sin sombra para las bloqueadas */
    }
    .lesson-card.locked button {
        background-color: #aaa; /* Bot√≥n deshabilitado */
        cursor: not-allowed;
    }
    .lesson-card.locked .unlock-message {
        color: #777;
        font-size: 0.85rem;
        margin-top: 10px;
    }

    #perfil form {
      max-width: 400px;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    #perfil input {
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #fff; /* Asegurar color de fondo en claro */
      color: #4a3054; /* Asegurar color de texto en claro */
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; /* Transici√≥n para el modo oscuro */
    }
    #perfil button {
      width: fit-content;
      background-color: #c39bd3;
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease, color 0.3s ease; /* Transici√≥n para el modo oscuro */
    }
    .logo-movil {
      display: none;
    }
    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }
      aside {
        width: 100%;
        flex-direction: row;
        justify-content: space-around;
        padding: 1rem;
        position: sticky;
        top: 0;
        z-index: 1000;
      }
      aside img,
      aside h1 {
        display: none;
      }
      aside button {
        flex: 1;
        font-size: 0.9rem;
        padding: 0.5rem;
      }
      main {
        padding: 1rem;
      }
      .lessons {
        grid-template-columns: 1fr;
      }
      .lesson-card {
        padding: 1rem;
      }
      .logo-movil {
        display: block;
        position: fixed;
        top: 10px;
        right: 10px;
        width: 50px;
        height: auto;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        z-index: 1001;
      }
    }
    /* Modo oscuro */
    body.dark-mode {
      background-color: #1e1e2f;  /* Fondo oscuro */
      color: #e0d8f0;             /* Letras claras */
    }
    body.dark-mode aside {
      background-color: #3a2a52;
      color: #dcd6f7;
    }
    body.dark-mode aside button {
      color: #dcd6f7;
    }
    body.dark-mode aside button:hover {
      background-color: #6b5498;
    }
    body.dark-mode main {
      background-color: #1e1e2f;
      color: #e0d8f0;
    }
    body.dark-mode .lesson-card {
      background-color: #2b2440;
      color: #ddd;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    }
    body.dark-mode .lesson-card p {
        color: #bbb; /* Color para el texto del p√°rrafo en modo oscuro */
    }
    body.dark-mode .lesson-card button {
      background-color: #6b5498;
      color: #fff;
    }
    body.dark-mode .lesson-card.completed {
      border-color: #af7ac5; /* Mantener color de borde similar */
    }
    body.dark-mode .progress-bar-container {
      background-color: #4e3f70;
    }
    body.dark-mode .progress-bar-fill {
      background-color: #a87ce2;
    }
    body.dark-mode #perfilResumen {
      background-color: #3a2a52;
      color: #e0d8f0;
    }
    body.dark-mode #perfil input {
      background-color: #4e3f70;
      color: #ddd;
      border-color: #6b5498;
    }
    body.dark-mode #perfil button {
      background-color: #6b5498;
      color: white;
    }
    body.dark-mode .search-container input {
      background-color: #4e3f70;
      color: #ddd;
      border-color: #6b5498;
    }
    body.dark-mode .lesson-card.locked {
        background-color: #2b2440; /* Fondo m√°s oscuro para tarjetas bloqueadas */
        opacity: 0.4; /* Menos opacidad para que resalte m√°s el bloqueo */
    }
    body.dark-mode .lesson-card.locked .unlock-message {
        color: #999; /* Color m√°s claro para el mensaje de bloqueo en modo oscuro */
    }
  </style>
</head>
<body>
  <img class="logo-movil" src="https://i.postimg.cc/gktsPS9Z/1000040884.png" alt="Logo ALSI m√≥vil" />
  <aside>
    <img src="https://i.postimg.cc/gktsPS9Z/1000040884.png" alt="Logo ALSI" />
    <h1>ALSI</h1>
    <button onclick="showSection('lecciones')">Lecciones</button>
    <button onclick="showSection('progreso')">Progreso</button>
    <button onclick="showSection('perfil')">Perfil</button>
   <button type="button" onclick="cerrarSesion()">Salir</button>
   <button id="toggle-dark-mode" type="button">üåô Modo Oscuro</button>
  </aside>
  <main>
    <div class="progress-bar-container">
      <div class="progress-bar-fill" id="progressFill"></div>
    </div>

    <section id="lecciones">
      <h2>Elige una lecci√≥n para comenzar</h2>
      <div class="search-container">
        <input type="text" id="busqueda" placeholder="Buscar lecci√≥n..." oninput="filtrarLecciones()" />
      </div>
      <div class="lessons" id="lessons-container">
        <div class="lesson-card" id="lesson1" data-leccion-id="1" data-titulo="Lecci√≥n 1" data-quiz-required="true" data-min-score="70">
          <img src="TP1/leccion1.png" alt="Lecci√≥n 1" style="width:100%;border-radius:12px;margin-bottom:1rem;">
          <h3>Lecci√≥n 1</h3>
          <p>Introducci√≥n a las se√±as b√°sicas.</p>
        </div>

        <div class="lesson-card" id="lesson2" data-leccion-id="2" data-titulo="Lecci√≥n 2" data-quiz-required="true" data-min-score="70">
          <img src="TP1/leccion2.png" alt="Lecci√≥n 2" style="width:100%;border-radius:12px;margin-bottom:1rem;">
          <h3>Lecci√≥n 2</h3>
          <p>Abecedario dactilol√≥gico.</p>
        </div>

        <div class="lesson-card" id="lesson3" data-leccion-id="3" data-titulo="Lecci√≥n 3" data-quiz-required="false">
          <img src="TP1/leccion3.png" alt="Lecci√≥n 3" style="width:100%;border-radius:12px;margin-bottom:1rem;">
          <h3>Lecci√≥n 3</h3>
          <p>Colores y n√∫meros.</p>
        </div>

        <div class="lesson-card" id="lesson4" data-leccion-id="4" data-titulo="Lecci√≥n 4" data-quiz-required="true" data-min-score="60">
          <img src="TP1/leccion4.png" alt="Lecci√≥n 4" style="width:100%;border-radius:12px;margin-bottom:1rem;">
          <h3>Lecci√≥n 4</h3>
          <p>D√≠as de la semana y tiempo.</p>
        </div>
      </div>
    </section>

    <section id="progreso" style="display:none">
      <h2>Progreso del usuario</h2>
      <ul id="lista-progreso"></ul>
      <button type="button" onclick="reiniciarProgreso()" style="margin-top: 1rem; background-color: #e74c3c; color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 8px; cursor: pointer;">
        Reiniciar progreso
      </button>
    </section>

    <section id="perfil" style="display:none">
      <h2>Perfil del usuario</h2>
      <form onsubmit="guardarPerfil(event)" id="form-perfil">
        <input type="text" id="nombre" placeholder="Nombre" />
        <input type="email" id="correo" placeholder="Correo electr√≥nico" />
       <button type="submit">Guardar perfil</button>
      </form>
    <div id="contenido-leccion"></div>
  </main>

  <script>
    // Tu script de Dark Mode y manejo de secciones existente
    const toggleDarkModeBtn = document.getElementById('toggle-dark-mode');
    const body = document.body;
    const localStorageDarkModeKey = 'darkMode'; // Clave unificada con las otras p√°ginas

    function aplicarModoOscuroInicial() {
      const savedMode = localStorage.getItem(localStorageDarkModeKey);
      if (savedMode === 'enabled') {
        body.classList.add('dark-mode');
        toggleDarkModeBtn.textContent = '‚òÄÔ∏è Modo Claro';
      } else if (savedMode === 'disabled') {
        body.classList.remove('dark-mode');
        toggleDarkModeBtn.textContent = 'üåô Modo Oscuro';
      } else {
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          body.classList.add('dark-mode');
          toggleDarkModeBtn.textContent = '‚òÄÔ∏è Modo Claro';
        } else {
          body.classList.remove('dark-mode');
          toggleDarkModeBtn.textContent = 'üåô Modo Oscuro';
        }
      }
    }

    if (window.matchMedia) {
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
        if (!localStorage.getItem(localStorageDarkModeKey)) { // Solo si el usuario no ha forzado un modo
          if (event.matches) {
            body.classList.add('dark-mode');
            toggleDarkModeBtn.textContent = '‚òÄÔ∏è Modo Claro';
          } else {
            body.classList.remove('dark-mode');
            toggleDarkModeBtn.textContent = 'üåô Modo Oscuro';
          }
        }
      });
    }

    toggleDarkModeBtn.addEventListener('click', () => {
      body.classList.toggle('dark-mode');
      if (body.classList.contains('dark-mode')) {
        toggleDarkModeBtn.textContent = '‚òÄÔ∏è Modo Claro';
        localStorage.setItem(localStorageDarkModeKey, 'enabled');
      } else {
        toggleDarkModeBtn.textContent = 'üåô Modo Oscuro';
        localStorage.setItem(localStorageDarkModeKey, 'disabled');
      }
    });

    function showSection(id) {
      const secciones = ['lecciones', 'progreso', 'perfil'];
      secciones.forEach(sec => {
        document.getElementById(sec).style.display = sec === id ? 'block' : 'none';
      });
      // Cuando se muestra la secci√≥n de progreso, actualizar la lista
      if (id === 'progreso') {
          displayProgress();
      }
    }

    function guardarPerfil(event) {
      event.preventDefault();
      const nombre = document.getElementById('nombre').value;
      const correo = document.getElementById('correo').value;
      const perfil = { nombre, correo };
      localStorage.setItem('perfilUsuario', JSON.stringify(perfil));
      alert('¬°Perfil guardado exitosamente!');
    }

    function reiniciarProgreso() {
        if (confirm('¬øEst√°s seguro de que quieres reiniciar tu progreso? Se borrar√°n todas las lecciones completadas.')) {
            const keysToRemove = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('lessonProgress_')) {
                    keysToRemove.push(key);
                }
            }
            keysToRemove.forEach(key => localStorage.removeItem(key));

            // Despu√©s de borrar, la Lecci√≥n 1 debe volver a estar desbloqueada.
            saveProgress('lesson1', 'unlocked');

            updateLessonAvailability(); // Recalcula el estado de todas las lecciones
            displayProgress(); // Actualiza la vista de progreso
            updateProgressBar(); // Actualiza la barra de progreso
            alert('Tu progreso ha sido reiniciado.');
        }
    }

    function cerrarSesion() {
      alert('Sesi√≥n cerrada.');
      // Aqu√≠ puedes a√±adir l√≥gica para limpiar tokens o redirigir
      // window.location.href = 'login.html'; // Ejemplo de redirecci√≥n
    }

    // --- JAVASCRIPT PARA PROGRESO Y DESBLOQUEO DE LECCIONES ---

    const MIN_PASS_SCORE = 70; // Puntaje m√≠nimo global para aprobar si no se especifica en la lecci√≥n

    // Funci√≥n para cargar el progreso desde localStorage
    function loadProgress() {
        // Asegurarse de que lesson1 se marque como unlocked si no tiene estado.
        // Esto previene que se quede 'null' o 'locked' si se borra el localStorage.
        if (localStorage.getItem('lessonProgress_lesson1') === null) {
            saveProgress('lesson1', 'unlocked');
        }
        // Luego actualizamos la disponibilidad de todas las lecciones.
        updateLessonAvailability();
        updateProgressBar(); // Actualizar la barra de progreso al cargar
    }

    // Funci√≥n para guardar el progreso en localStorage
    function saveProgress(lessonId, status) {
        localStorage.setItem(`lessonProgress_${lessonId}`, status);
        updateProgressBar(); // Actualizar la barra de progreso cada vez que se guarda el progreso
    }

    // Funci√≥n para actualizar el estado de bloqueo/desbloqueo de las lecciones
    function updateLessonAvailability() {
        const lessons = document.querySelectorAll('.lesson-card');
        for (let i = 0; i < lessons.length; i++) {
            const currentLesson = lessons[i];
            const currentLessonId = currentLesson.id;
            const leccionDataId = parseInt(currentLesson.dataset.leccionId);

            // Limpiar clases y mensajes de bloqueo/desbloqueo anteriores
            currentLesson.classList.remove('locked', 'completed'); // Remover 'completed' tambi√©n para reevaluar
            currentLesson.style.pointerEvents = "auto"; // Re-habilitar clics por defecto
            let unlockMessage = currentLesson.querySelector('.unlock-message');
            if (unlockMessage) {
                unlockMessage.remove();
            }
            // Asegurar que el check de completado no est√© si no lo est√°
            const existingCheck = currentLesson.querySelector('.check');
            if (existingCheck) {
                existingCheck.remove();
            }

            const currentLessonStatus = localStorage.getItem(`lessonProgress_${currentLessonId}`);

            // L√≥gica para el estado de la Lecci√≥n 1 (siempre desbloqueada para empezar)
            if (leccionDataId === 1) {
                if (currentLessonStatus === 'completed') {
                    currentLesson.classList.add('completed');
                    currentLesson.innerHTML += '<span class="check">‚úÖ</span>';
                }
                // Si est√° desbloqueada o nula, ya fue manejada al inicio de loadProgress para ser 'unlocked'
                currentLesson.onclick = () => cargarLeccion(leccionDataId);
                continue; // Pasar a la siguiente lecci√≥n
            }

            // L√≥gica para las lecciones siguientes
            const previousLesson = document.querySelector(`.lesson-card[data-leccion-id="${leccionDataId - 1}"]`);
            if (!previousLesson) {
                console.warn(`No se encontr√≥ la lecci√≥n anterior para ${currentLessonId}. Lecci√≥n probablemente bloqueada.`);
                currentLesson.classList.add('locked');
                currentLesson.style.pointerEvents = "none";
                currentLesson.onclick = null;
                unlockMessage = document.createElement('p');
                unlockMessage.classList.add('unlock-message');
                unlockMessage.textContent = 'Lecci√≥n anterior no encontrada o no v√°lida.';
                currentLesson.appendChild(unlockMessage);
                saveProgress(currentLessonId, 'locked');
                continue;
            }

            const previousLessonId = previousLesson.id;
            const previousQuizRequired = previousLesson.dataset.quizRequired === 'true';
            const isPreviousLessonCompleted = localStorage.getItem(`lessonProgress_${previousLessonId}`) === 'completed';

            if (previousQuizRequired) {
                if (isPreviousLessonCompleted) {
                    // Desbloquear si la anterior con quiz requerido est√° completada
                    saveProgress(currentLessonId, 'unlocked');
                    currentLesson.onclick = () => cargarLeccion(leccionDataId);
                } else {
                    // Bloquear si la anterior con quiz requerido NO est√° completada
                    currentLesson.classList.add('locked');
                    currentLesson.style.pointerEvents = "none";
                    currentLesson.onclick = null;
                    unlockMessage = document.createElement('p');
                    unlockMessage.classList.add('unlock-message');
                    unlockMessage.textContent = 'Completa el cuestionario de la lecci√≥n anterior para desbloquear.';
                    currentLesson.appendChild(unlockMessage);
                    saveProgress(currentLessonId, 'locked');
                }
            } else {
                // Si la lecci√≥n anterior NO requer√≠a quiz, solo necesita estar "unlocked" o "completed"
                const isPreviousLessonUnlockedOrCompleted = (localStorage.getItem(`lessonProgress_${previousLessonId}`) === 'unlocked' || isPreviousLessonCompleted);
                if (isPreviousLessonUnlockedOrCompleted) {
                    saveProgress(currentLessonId, 'unlocked');
                    currentLesson.onclick = () => cargarLeccion(leccionDataId);
                } else {
                    currentLesson.classList.add('locked');
                    currentLesson.style.pointerEvents = "none";
                    currentLesson.onclick = null;
                    unlockMessage = document.createElement('p');
                    unlockMessage.classList.add('unlock-message');
                    unlockMessage.textContent = 'Completa la lecci√≥n anterior para desbloquear.';
                    currentLesson.appendChild(unlockMessage);
                    saveProgress(currentLessonId, 'locked');
                }
            }

            // Despu√©s de determinar si est√° bloqueada o desbloqueada, verificar si est√° completada
            if (localStorage.getItem(`lessonProgress_${currentLessonId}`) === 'completed') {
                currentLesson.classList.add('completed');
                currentLesson.innerHTML += '<span class="check">‚úÖ</span>';
            }
        }
    }


    // Funci√≥n para simular el env√≠o de un cuestionario (llamada desde los quizzes)
    function submitQuiz(lessonId, scoreObtained) { // lessonId debe ser el ID del div de la lecci√≥n (ej. 'lesson1', 'lesson2')
        const lessonElement = document.getElementById(lessonId);
        if (!lessonElement) {
            console.error(`Lecci√≥n con ID ${lessonId} no encontrada.`);
            return;
        }

        const minScore = parseInt(lessonElement.dataset.minScore) || MIN_PASS_SCORE;
        let passed = false;

        if (scoreObtained >= minScore) {
            passed = true;
            alert(`¬°Cuestionario de ${lessonElement.dataset.titulo} aprobado con ${scoreObtained}%!`);
            saveProgress(lessonId, 'completed');
        } else {
            alert(`Cuestionario de ${lessonElement.dataset.titulo} reprobado con ${scoreObtained}%. Necesitas ${minScore}%.`);
            // Si reprueba, la lecci√≥n sigue "unlocked" para que pueda reintentar el quiz.
            saveProgress(lessonId, 'unlocked');
        }

        // No actualizamos la UI aqu√≠ porque el usuario generalmente regresar√° al index.html
        // donde DOMContentLoaded llamar√° a loadProgress y updateLessonAvailability.
    }

    // Funci√≥n para manejar el clic en las tarjetas de lecci√≥n (para ir a la lecci√≥n)
    function cargarLeccion(leccionDataId) {
        const lessonElement = document.querySelector(`.lesson-card[data-leccion-id="${leccionDataId}"]`);
        const lessonId = lessonElement.id;

        // Si la lecci√≥n no tiene cuestionario obligatorio y est√° desbloqueada, marcarla como completada al hacer clic
        // Esto es para lecciones puramente informativas que se "completan" al visitarlas
        if (lessonElement.dataset.quizRequired !== 'true' && localStorage.getItem(`lessonProgress_${lessonId}`) === 'unlocked') {
            saveProgress(lessonId, 'completed');
            // No es necesario llamar a updateLessonAvailability aqu√≠, ya que el usuario se redirige
            // y al volver al index, se volver√° a cargar.
        }

        window.location.href = `leccion${leccionDataId}.html`; // Redirige a la p√°gina de la lecci√≥n
    }

    // Funci√≥n para actualizar la barra de progreso
    function updateProgressBar() {
        const totalLessons = document.querySelectorAll('.lesson-card').length;
        let completedLessonsCount = 0;
        document.querySelectorAll('.lesson-card').forEach(lesson => {
            const lessonId = lesson.id;
            if (localStorage.getItem(`lessonProgress_${lessonId}`) === 'completed') {
                completedLessonsCount++;
            }
        });
        const progressPercentage = (totalLessons > 0) ? (completedLessonsCount / totalLessons) * 100 : 0;
        document.getElementById('progressFill').style.width = `${progressPercentage}%`;
    }

    // Funci√≥n para mostrar el progreso en la secci√≥n "Progreso"
    function displayProgress() {
        const listaProgreso = document.getElementById('lista-progreso');
        listaProgreso.innerHTML = ''; // Limpiar lista
        const lessons = document.querySelectorAll('.lesson-card');
        lessons.forEach(lesson => {
            const lessonId = lesson.id;
            const title = lesson.dataset.titulo;
            const status = localStorage.getItem(`lessonProgress_${lessonId}`) || 'locked'; // 'locked', 'unlocked', 'completed'

            const listItem = document.createElement('li');
            let statusText = '';
            let statusColor = '';

            switch (status) {
                case 'completed':
                    statusText = '‚úÖ Completada';
                    statusColor = 'green';
                    break;
                case 'unlocked':
                    statusText = '‚û°Ô∏è Desbloqueada (Pendiente)';
                    statusColor = 'orange';
                    break;
                case 'locked':
                    statusText = 'üîí Bloqueada';
                    statusColor = 'red';
                    break;
                default:
                    statusText = 'Estado desconocido';
                    statusColor = 'gray';
            }
            listItem.innerHTML = `${title}: <span style="color: ${statusColor};">${statusText}</span>`;
            listaProgreso.appendChild(listItem);
        });
    }

    // Funci√≥n de b√∫squeda
    function filtrarLecciones() {
        const input = document.getElementById('busqueda');
        const filtro = input.value.toLowerCase();
        const lessonsContainer = document.getElementById('lessons-container');
        const cards = lessonsContainer.querySelectorAll('.lesson-card');

        cards.forEach(card => {
            const title = card.dataset.titulo.toLowerCase();
            if (title.includes(filtro)) {
                card.style.display = ''; // Mostrar
            } else {
                card.style.display = 'none'; // Ocultar
            }
        });
    }

    // Asegurarse de que todo se inicialice al cargar la p√°gina
    document.addEventListener('DOMContentLoaded', () => {
        aplicarModoOscuroInicial();
        loadProgress(); // Carga el progreso inicial y actualiza la disponibilidad de las lecciones
        // Nota: updateProgressBar y displayProgress son llamadas dentro de loadProgress y saveProgress
        // Por lo que no es necesario llamarlas directamente aqu√≠ de nuevo.
    });

    // A√±adir event listener para hacer click en la tarjeta y cargar la lecci√≥n (delegado para manejar bloqueo)
    document.querySelectorAll('.lesson-card').forEach(card => {
        // Removemos el onclick directo del HTML si lo ten√≠as para evitar duplicaci√≥n
        // y para que updateLessonAvailability pueda gestionarlo.
        // No a√±adimos aqu√≠, updateLessonAvailability lo har√° por nosotros.
    });

  </script>
</body>
</html>
